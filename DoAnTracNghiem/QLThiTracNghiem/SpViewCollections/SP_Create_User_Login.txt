create proc [dbo].[SP_Create_User_Login]
@loginname nvarchar(10), @password nvarchar(50),
@role nvarchar(10), @magv nvarchar(10)
as
begin
declare @res int
exec @res = sp_addlogin @loginname, @password, 'DB_THI_TN'
if(@res = 1)
begin 
	raiserror('Login name bị trùng', 16, 1)
	return
end
exec @res = sp_grantdbaccess @loginname, @magv
if(@res = 1)
begin
	exec sp_droplogin @loginname
	raiserror('Mã giảng viên đã tồn tại',16, 2)
	return
end
begin try
exec sp_addrolemember @role, @magv
end try
begin catch
	exec sp_droplogin @loginname
	raiserror('Sai tên role', 16,2)
	return
end catch
end
GO


